<div class="analytics-container">
    <!-- Header Section -->
    <div class="analytics-header" [@fadeInDown]="{value: '*', params: {delay: 100}}">
        <div class="header-content">
            <div class="title-section">
                <h1 class="page-title">Analytics Dashboard</h1>
                <p class="page-subtitle">Real-time insights and performance metrics</p>
            </div>
            <div class="header-actions">
                <div class="real-time-indicator" [@pulse]="'pulse'">
                    <div class="indicator-dot"></div>
                    <span>Live</span>
                </div>
                <button class="refresh-btn" (click)="refreshData()" [disabled]="isLoading">
                    <mat-icon>{{ isLoading ? 'refresh' : 'refresh' }}</mat-icon>
                    <span>Refresh</span>
                </button>
            </div>
        </div>
    </div>

    <!-- Key Metrics Cards -->
    <div class="metrics-grid" [@fadeInUp]="{value: '*', params: {delay: 200}}">
        <div class="metric-card" [@slideInLeft]="{value: '*', params: {delay: 300}}">
            <div class="metric-icon">
                <mat-icon>assignment</mat-icon>
            </div>
            <div class="metric-content">
                <div class="metric-value">{{ totalTasks }}</div>
                <div class="metric-label">Total Tasks</div>
                <div class="metric-change" [ngClass]="{'positive': taskGrowth > 0, 'negative': taskGrowth < 0}">
                    <mat-icon>{{ taskGrowth > 0 ? 'trending_up' : 'trending_down' }}</mat-icon>
                    <span>{{ Math.abs(taskGrowth) }}%</span>
                </div>
            </div>
        </div>

        <div class="metric-card" [@slideInLeft]="{value: '*', params: {delay: 400}}">
            <div class="metric-icon">
                <mat-icon>check_circle</mat-icon>
            </div>
            <div class="metric-content">
                <div class="metric-value">{{ completedTasks }}</div>
                <div class="metric-label">Completed</div>
                <div class="metric-change" [ngClass]="{'positive': completionGrowth > 0, 'negative': completionGrowth < 0}">
                    <mat-icon>{{ completionGrowth > 0 ? 'trending_up' : 'trending_down' }}</mat-icon>
                    <span>{{ Math.abs(completionGrowth) }}%</span>
                </div>
            </div>
        </div>

        <div class="metric-card" [@slideInLeft]="{value: '*', params: {delay: 500}}">
            <div class="metric-icon">
                <mat-icon>schedule</mat-icon>
            </div>
            <div class="metric-content">
                <div class="metric-value">{{ pendingTasks }}</div>
                <div class="metric-label">Pending</div>
                <div class="metric-change" [ngClass]="{'positive': pendingGrowth > 0, 'negative': pendingGrowth < 0}">
                    <mat-icon>{{ pendingGrowth > 0 ? 'trending_up' : 'trending_down' }}</mat-icon>
                    <span>{{ Math.abs(pendingGrowth) }}%</span>
                </div>
            </div>
        </div>

        <div class="metric-card" [@slideInLeft]="{value: '*', params: {delay: 600}}">
            <div class="metric-icon">
                <mat-icon>speed</mat-icon>
            </div>
            <div class="metric-content">
                <div class="metric-value">{{ productivityScore }}%</div>
                <div class="metric-label">Productivity</div>
                <div class="metric-change" [ngClass]="{'positive': productivityGrowth > 0, 'negative': productivityGrowth < 0}">
                    <mat-icon>{{ productivityGrowth > 0 ? 'trending_up' : 'trending_down' }}</mat-icon>
                    <span>{{ Math.abs(productivityGrowth) }}%</span>
                </div>
            </div>
        </div>
    </div>

    <!-- Charts Section -->
    <div class="charts-section" [@fadeInUp]="{value: '*', params: {delay: 700}}">
        <div class="chart-row">
            <!-- Task Completion Trend -->
            <div class="chart-card" [@slideInUp]="{value: '*', params: {delay: 800}}">
                <div class="chart-header">
                    <h3>Task Completion Trend</h3>
                    <div class="chart-actions">
                        <button class="time-filter-btn" 
                                [class.active]="selectedTimeRange === 'week'"
                                (click)="setTimeRange('week')">Week</button>
                        <button class="time-filter-btn" 
                                [class.active]="selectedTimeRange === 'month'"
                                (click)="setTimeRange('month')">Month</button>
                        <button class="time-filter-btn" 
                                [class.active]="selectedTimeRange === 'year'"
                                (click)="setTimeRange('year')">Year</button>
                    </div>
                </div>
                <div class="chart-container">
                    <canvas #completionChart></canvas>
                </div>
            </div>

            <!-- Task Status Distribution -->
            <div class="chart-card" [@slideInUp]="{value: '*', params: {delay: 900}}">
                <div class="chart-header">
                    <h3>Task Status Distribution</h3>
                    <div class="chart-legend">
                        <div class="legend-item">
                            <div class="legend-color completed"></div>
                            <span>Completed</span>
                        </div>
                        <div class="legend-item">
                            <div class="legend-color in-progress"></div>
                            <span>In Progress</span>
                        </div>
                        <div class="legend-item">
                            <div class="legend-color pending"></div>
                            <span>Pending</span>
                        </div>
                    </div>
                </div>
                <div class="chart-container">
                    <canvas #statusChart></canvas>
                </div>
            </div>
        </div>

        <div class="chart-row">
            <!-- Priority Distribution -->
            <div class="chart-card" [@slideInUp]="{value: '*', params: {delay: 1000}}">
                <div class="chart-header">
                    <h3>Priority Distribution</h3>
                </div>
                <div class="chart-container">
                    <canvas #priorityChart></canvas>
                </div>
            </div>

            <!-- Real-time Activity Feed -->
            <div class="chart-card activity-feed" [@slideInUp]="{value: '*', params: {delay: 1100}}">
                <div class="chart-header">
                    <h3>Real-time Activity</h3>
                    <div class="activity-indicator" [@pulse]="'pulse'">
                        <div class="indicator-dot"></div>
                        <span>Live Updates</span>
                    </div>
                </div>
                <div class="activity-container">
                    <div class="activity-list" #activityList>
                        <div *ngFor="let activity of recentActivities; let i = index" 
                             class="activity-item" 
                             [@slideInRight]="{value: '*', params: {delay: i * 100}}">
                            <div class="activity-icon" [ngClass]="activity.type">
                                <mat-icon>{{ activity.icon }}</mat-icon>
                            </div>
                            <div class="activity-content">
                                <div class="activity-title">{{ activity.title }}</div>
                                <div class="activity-time">{{ activity.time }}</div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Performance Insights -->
    <div class="insights-section" [@fadeInUp]="{value: '*', params: {delay: 1200}}">
        <h2>Performance Insights</h2>
        <div class="insights-grid">
            <div class="insight-card" [@slideInLeft]="{value: '*', params: {delay: 1300}}">
                <div class="insight-header">
                    <mat-icon>trending_up</mat-icon>
                    <h4>Top Performer</h4>
                </div>
                <div class="insight-content">
                    <div class="performer-info">
                        <div class="performer-avatar">
                            <mat-icon>person</mat-icon>
                        </div>
                        <div class="performer-details">
                            <div class="performer-name">{{ topPerformer.name }}</div>
                            <div class="performer-stats">{{ topPerformer.completedTasks }} tasks completed</div>
                        </div>
                    </div>
                </div>
            </div>

            <div class="insight-card" [@slideInLeft]="{value: '*', params: {delay: 1400}}">
                <div class="insight-header">
                    <mat-icon>schedule</mat-icon>
                    <h4>Average Completion Time</h4>
                </div>
                <div class="insight-content">
                    <div class="time-metric">
                        <div class="time-value">{{ averageCompletionTime }}</div>
                        <div class="time-label">days per task</div>
                    </div>
                </div>
            </div>

            <div class="insight-card" [@slideInLeft]="{value: '*', params: {delay: 1500}}">
                <div class="insight-header">
                    <mat-icon>calendar_today</mat-icon>
                    <h4>This Week's Progress</h4>
                </div>
                <div class="insight-content">
                    <div class="progress-info">
                        <div class="progress-bar">
                            <div class="progress-fill" [style.width.%]="weeklyProgress"></div>
                        </div>
                        <div class="progress-text">{{ weeklyProgress }}% of weekly goal</div>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>
